<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>examples/js/stories/annotationStory.js - xeogl</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link href='https://fonts.googleapis.com/css?family=Exo+2:400,800,900,700,600,500|Roboto:100,300,400,500,700,900'  rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">

                <h1 class="projectTitle"><a href="../../">xeogl</a> / <a href="../../docs">API Docs</a></h1>

        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.7.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AABBGeometry.html">AABBGeometry</a></li>
                                <li><a href="../classes/AABBHelper.html">AABBHelper</a></li>
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/Annotation.html">Annotation</a></li>
                                <li><a href="../classes/AnnotationStory.html">AnnotationStory</a></li>
                                <li><a href="../classes/AxisHelper.html">AxisHelper</a></li>
                                <li><a href="../classes/BoxGeometry.html">BoxGeometry</a></li>
                                <li><a href="../classes/BuildableModel.html">BuildableModel</a></li>
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/CameraControl.html">CameraControl</a></li>
                                <li><a href="../classes/CameraFlightAnimation.html">CameraFlightAnimation</a></li>
                                <li><a href="../classes/CameraFollowAnimation.html">CameraFollowAnimation</a></li>
                                <li><a href="../classes/CameraPath.html">CameraPath</a></li>
                                <li><a href="../classes/CameraPathAnimation.html">CameraPathAnimation</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/Clip.html">Clip</a></li>
                                <li><a href="../classes/ClipHelper.html">ClipHelper</a></li>
                                <li><a href="../classes/Clips.html">Clips</a></li>
                                <li><a href="../classes/Component.html">Component</a></li>
                                <li><a href="../classes/CubeTexture.html">CubeTexture</a></li>
                                <li><a href="../classes/CubicBezierCurve.html">CubicBezierCurve</a></li>
                                <li><a href="../classes/Curve.html">Curve</a></li>
                                <li><a href="../classes/CylinderGeometry.html">CylinderGeometry</a></li>
                                <li><a href="../classes/DirLight.html">DirLight</a></li>
                                <li><a href="../classes/EmphasisMaterial.html">EmphasisMaterial</a></li>
                                <li><a href="../classes/Entity.html">Entity</a></li>
                                <li><a href="../classes/Fresnel.html">Fresnel</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/GeometryBuilder.html">GeometryBuilder</a></li>
                                <li><a href="../classes/GLTFModel.html">GLTFModel</a></li>
                                <li><a href="../classes/HeightmapGeometry.html">HeightmapGeometry</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/LabelHelper.html">LabelHelper</a></li>
                                <li><a href="../classes/LambertMaterial.html">LambertMaterial</a></li>
                                <li><a href="../classes/Lights.html">Lights</a></li>
                                <li><a href="../classes/LoadingEffect.html">LoadingEffect</a></li>
                                <li><a href="../classes/Lookat.html">Lookat</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/MetallicMaterial.html">MetallicMaterial</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Nintendo3DSGeometry.html">Nintendo3DSGeometry</a></li>
                                <li><a href="../classes/OBBGeometry.html">OBBGeometry</a></li>
                                <li><a href="../classes/OBBHelper.html">OBBHelper</a></li>
                                <li><a href="../classes/OBJGeometry.html">OBJGeometry</a></li>
                                <li><a href="../classes/OBJModel.html">OBJModel</a></li>
                                <li><a href="../classes/Ortho.html">Ortho</a></li>
                                <li><a href="../classes/OutlineMaterial.html">OutlineMaterial</a></li>
                                <li><a href="../classes/Path.html">Path</a></li>
                                <li><a href="../classes/PathGeometry.html">PathGeometry</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PhongMaterial.html">PhongMaterial</a></li>
                                <li><a href="../classes/Pin.html">Pin</a></li>
                                <li><a href="../classes/PlaneGeometry.html">PlaneGeometry</a></li>
                                <li><a href="../classes/PlaneHelper.html">PlaneHelper</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/QuadraticBezierCurve.html">QuadraticBezierCurve</a></li>
                                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
                                <li><a href="../classes/Rotate.html">Rotate</a></li>
                                <li><a href="../classes/Scale.html">Scale</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/SceneJSModel.html">SceneJSModel</a></li>
                                <li><a href="../classes/Shadow.html">Shadow</a></li>
                                <li><a href="../classes/Skybox.html">Skybox</a></li>
                                <li><a href="../classes/SpecularMaterial.html">SpecularMaterial</a></li>
                                <li><a href="../classes/SphereGeometry.html">SphereGeometry</a></li>
                                <li><a href="../classes/Spinner.html">Spinner</a></li>
                                <li><a href="../classes/SplineCurve.html">SplineCurve</a></li>
                                <li><a href="../classes/SplineCurveHelper.html">SplineCurveHelper</a></li>
                                <li><a href="../classes/SpotLight.html">SpotLight</a></li>
                                <li><a href="../classes/StereoEffect.html">StereoEffect</a></li>
                                <li><a href="../classes/STLModel.html">STLModel</a></li>
                                <li><a href="../classes/Story.html">Story</a></li>
                                <li><a href="../classes/TeapotGeometry.html">TeapotGeometry</a></li>
                                <li><a href="../classes/TestModel.html">TestModel</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/TorusGeometry.html">TorusGeometry</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Translate.html">Translate</a></li>
                                <li><a href="../classes/VectorTextGeometry.html">VectorTextGeometry</a></li>
                                <li><a href="../classes/Viewport.html">Viewport</a></li>
                                <li><a href="../classes/xeogl.html">xeogl</a></li>
                                <li><a href="../classes/xeogl.math.math.html">xeogl.math.math</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="..//modules/animation.html">animation</a></li>
                                <li><a href="..//modules/annotations.html">annotations</a></li>
                                <li><a href="..//modules/camera.html">camera</a></li>
                                <li><a href="..//modules/canvas.html">canvas</a></li>
                                <li><a href="..//modules/clipping.html">clipping</a></li>
                                <li><a href="..//modules/controls.html">controls</a></li>
                                <li><a href="..//modules/curves.html">curves</a></li>
                                <li><a href="..//modules/effects.html">effects</a></li>
                                <li><a href="..//modules/entities.html">entities</a></li>
                                <li><a href="..//modules/generation.html">generation</a></li>
                                <li><a href="..//modules/geometry.html">geometry</a></li>
                                <li><a href="..//modules/helpers.html">helpers</a></li>
                                <li><a href="..//modules/input.html">input</a></li>
                                <li><a href="..//modules/lighting.html">lighting</a></li>
                                <li><a href="..//modules/materials.html">materials</a></li>
                                <li><a href="..//modules/math.html">math</a></li>
                                <li><a href="..//modules/models.html">models</a></li>
                                <li><a href="..//modules/rendering.html">rendering</a></li>
                                <li><a href="..//modules/skyboxes.html">skyboxes</a></li>
                                <li><a href="..//modules/stories.html">stories</a></li>
                                <li><a href="..//modules/transforms.html">transforms</a></li>
                                <li><a href="..//modules/xeogl.html">xeogl</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <!--<div id="api-options">-->
                    <!--Show:-->
                    <!--<label for="api-show-inherited">-->
                        <!--<input type="checkbox" id="api-show-inherited" checked>-->
                        <!--Inherited-->
                    <!--</label>-->
            
                    <!--<label for="api-show-protected">-->
                        <!--<input type="checkbox" id="api-show-protected">-->
                        <!--Protected-->
                    <!--</label>-->
            
                    <!--<label for="api-show-private">-->
                        <!--<input type="checkbox" id="api-show-private">-->
                        <!--Private-->
                    <!--</label>-->
                    <!--<label for="api-show-deprecated">-->
                        <!--<input type="checkbox" id="api-show-deprecated">-->
                        <!--Deprecated-->
                    <!--</label>-->
            
                <!--</div>-->
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: examples/js/stories/annotationStory.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function () {

    &quot;use strict&quot;;

    var speak = (function () {
        if (undefined === SpeechSynthesisUtterance) {
            return;
        }
        var msg = new SpeechSynthesisUtterance();
        var voices = window.speechSynthesis.getVoices();
        msg.voice = voices[10]; // Note: some voices don&#x27;t support altering params
        msg.voiceURI = &#x27;native&#x27;;
        msg.volume = 1.0; // 0 to 1
        msg.rate = 1.0; // 0.1 to 10
        msg.pitch = 1.0; //0 to 2
        msg.text = &#x27;Hello World&#x27;;
        msg.lang = &#x27;en-US&#x27;;
        return function (text) {
            msg.text = text;
            speechSynthesis.speak(msg);
        };
    })();

    var getDummyText = (function () {
        const dummyText = [
            &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Egone non intellego, quid sit don Graece, Latine voluptas?.&quot;,
            &quot;An est aliquid per se ipsum flagitiosum, etiamsi nulla comitetur infamia?&quot;,
            &quot;Cur igitur easdem res, inquam, Peripateticis dicentibus verbum nullum est, quod non intellegatur?&quot;,
            &quot;Nec enim, omnes avaritias si aeque avaritias esse dixerimus, sequetur ut etiam aequas esse dicamus. Quid enim de amicitia statueris utilitatis causa expetenda vides.&quot;,
            &quot;Quis animo aequo videt eum, quem inpure ac flagitiose putet vivere?&quot;,
            &quot;Quod cum accidisset ut alter alterum necopinato videremus, surrexit statim. Quis non odit sordidos, vanos, leves, futtiles?&quot;,
            &quot;Cupit enim d√≠cere nihil posse ad beatam vitam deesse sapienti.&quot;
        ];
        var i = 0;
        return function () {
            var text = dummyText[i];
            if (++i &gt;= dummyText.length) {
                i = 0;
            }
            return text;
        };
    })();

    /**
     An **AnnotationStory** is a  {{#crossLink &quot;Story&quot;}}{{/crossLink}} that contains a list
     of {{#crossLink &quot;Annotation&quot;}}Annotations{{/crossLink}} accompanied by a panel of text containing links that activate them.

     &lt;a href=&quot;../../examples/#annotations_stories_tronTank&quot;&gt;&lt;img src=&quot;../../assets/images/screenshots/tronTankStory.jpg&quot;&gt;&lt;/img&gt;&lt;/a&gt;

     * AnnotationStory text is provided as markdown.
     * Words in the text can be linked to xeogl storytelling functions, to fly the camera to Annotation vantage points, show labels etc.

     ## Authoring Mode

     * SHIFT-click to place an Annotation
     * ESC to clear
     * ENTER to dump

     ## Examples

     * [Tron Tank Program AnnotationStory](../../examples/#annotations_stories_tronTank)

     ## Usage

     &#x60;&#x60;&#x60;&#x60;javascript
     // Load a Tron Tank model from SceneJS format. Give the model an ID - this
     // gets prefixed to the IDs of it&#x27;s Entities.

     var model = new xeogl.SceneJSModel({
            id: &quot;tank&quot;,
            src: &quot;models/scenejs/tronTank/tronTank.json&quot;
        });

     model.scene.camera.eye = [15, 20, -25];

     // When the model has loaded, create a story with annotations

     model.on(&quot;loaded&quot;, function () {

        new xeogl.AnnotationStory({
            speaking: false, // Set true to have a voice announce each annotation
            authoring: true, // Set true to author the annotations
            text: [
                &quot;# [Stories](../docs/classes/AnnotationStory.html) : Tron Tank Program&quot;,
                &quot;This is a Light Tank from the 1982 Disney movie *Tron*.&quot;,
                &quot;The [orange tracks](focusAnnotation(0)) on this tank indicate that ....&quot;,
                &quot;![](./images/Clu_Program.png)&quot;,
                &quot;The [cannon](focusAnnotation(1)) is the tank&#x27;s main armament, which  ....&quot;,
                &quot;The [pilot hatch](focusAnnotation(2)) is where Clu enters and exits the tank.&quot;,
                &quot;At the back of the tank is the [antenna](focusAnnotation(3)) through ....&quot;,
                &quot;*\&quot;I fight for the users!\&quot; -- Clu*&quot;
            ],
            annotations: [
                {
                    primIndex: 204,
                    bary: [0.05, 0.16, 0.79],
                    occludable: true,
                    glyph: &quot;A&quot;,
                    title: &quot;Orange tracks&quot;,
                    desc: &quot;Indicates that the pilot is the rebel hacker, Clu&quot;,
                    eye: [14.69, 17.89, -26.88],
                    look: [5.35, 4.14, -15.44],
                    up: [-0.09, 0.99, 0.11],
                    pinShown: true,
                    labelShown: true,
                    entity: &quot;tank.entity2&quot;
                },
                {
                    primIndex: 468,
                    bary: [0.05, 0.16, 0.79],
                    occludable: true,
                    glyph: &quot;B&quot;,
                    title: &quot;Cannon&quot;,
                    desc: &quot;Fires chevron-shaped bolts of de-rezzing energy&quot;,
                    eye: [-0.66, 20.84, -21.59],
                    look: [-0.39, 6.84, -9.18],
                    up: [0.01, 0.97, 0.24],
                    pinShown: true,
                    labelShown: true,
                    entity: &quot;tank.entity9&quot;
                },
                {
                    primIndex: 216,
                    bary: [0.05, 0.16, 0.79],
                    occludable: true,
                    glyph: &quot;C&quot;,
                    title: &quot;Pilot hatch&quot;,
                    desc: &quot;Clu hops in and out of the tank program here&quot;,
                    eye: [1.48, 11.79, -15.13],
                    look: [1.62, 5.04, -9.14],
                    up: [0.01, 0.97, 0.24],
                    pinShown: true,
                    labelShown: true,
                    entity: &quot;tank.entity6&quot;
                },
                {
                    primIndex: 4464,
                    bary: [0.05, 0.16, 0.79],
                    occludable: true,
                    glyph: &quot;D&quot;,
                    title: &quot;Antenna&quot;,
                    desc: &quot;Links the tank program to the Master Control Program&quot;,
                    eye: [13.63, 16.79, 13.87],
                    look: [1.08, 7.72, 3.07],
                    up: [0.08, 0.99, 0.07],
                    pinShown: true,
                    labelShown: true,
                    entity: &quot;tank.entity9&quot;
                }
            ]
        });
     });
     &#x60;&#x60;&#x60;&#x60;

     @class AnnotationStory
     @module xeogl
     @submodule stories
     @constructor
     @param [scene] {Scene} Parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} - creates this AnnotationStory in the default
     {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} when omitted.
     @param [cfg] {*} Configs
     @param [cfg.id] {String} Optional ID, unique among all components in the parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}},
     generated automatically when omitted.
     @param [cfg.meta] {String:Object} Optional map of user-defined metadata to attach to this AnnotationStory.

     @extends Story
     */
    xeogl.AnnotationStory = xeogl.Story.extend({

        type: &quot;xeogl.AnnotationStory&quot;,

        _init: function (cfg) {

            this._super(cfg);

            var self = this;

            this._speaking = !!cfg.speaking;
            this._authoring = !!cfg.authoring;
            this._annotations = [];

            if (cfg.annotations) {
                var annotation;
                var annotations = cfg.annotations;
                for (var i = 0, len = annotations.length; i &lt; len; i++) {
                    annotation = new xeogl.Annotation(this, annotations[i]);
                    //annotation.pinShown = true;
                    annotation.labelShown = false;
                    this._annotations.push(annotation);
                    annotation.on(&quot;pinClicked&quot;, (function () {
                        var i2 = i;
                        return function () {
                            self._actions.focusAnnotation.call(self, i2);
                        };
                    })());
                }
            }

            this._cameraFlight = new xeogl.CameraFlightAnimation(this, {duration: 1});
            this._cameraControl = new xeogl.CameraControl(this);

            //-------------------------------------------------------------------
            // Authoring mode
            //-------------------------------------------------------------------

            if (this._authoring) {

                var input = this.scene.input;
                var shiftDown = false;

                // SHIFT enables clicks to create annotations
                // ESC clears annotations
                // ENTER generates JS code for the AnnotationStory in a new browser tab

                input.on(&quot;keydown&quot;, function (keyCode) {
                    switch (keyCode) {
                        case this.KEY_SHIFT:
                            shiftDown = true;
                            self._cameraControl.mousePickEntity.active = false;
                            break;
                        case this.KEY_ESCAPE:
                            self._clear();
                            break;
                        case this.KEY_ENTER:
                            self._dump();
                            break;
                    }
                });

                input.on(&quot;keyup&quot;, function (keyCode) {
                    switch (keyCode) {
                        case this.KEY_SHIFT:
                            shiftDown = false;
                            self._cameraControl.mousePickEntity.active = true;
                            break;
                    }
                });

                // Click while SHIFT is down creates a new Annotation

                this._onMouseClicked = input.on(&quot;mouseclicked&quot;, function (coords) {

                    if (!shiftDown) {
                        return;
                    }

                    var hit = self.scene.pick({
                        canvasPos: coords,
                        pickSurface: true
                    });

                    if (hit) {

                        var entity = hit.entity;
                        var camera = entity.scene.camera;

                        var i = self._annotations.length;
                        var num = i + 1;
                        var glyph = &quot;&quot; + num;

                        var dummyText = getDummyText();

                        var annotation = new xeogl.Annotation(self.scene, {
                            entity: hit.entity.id,
                            primIndex: hit.primIndex,
                            bary: hit.bary,
                            glyph: glyph,
                            title: &quot;Annotation &quot; + num,
                            desc: dummyText,
                            eye: camera.eye,
                            look: camera.look,
                            up: camera.up,
                            pinShown: true,
                            labelShown: true
                        });

                        annotation.on(&quot;pinClicked&quot;, function () {
                            self._actions.focusAnnotation.call(self, i);
                        });

                        self._annotations.push(annotation);

                        var text = self.text;
                        text.push(&quot;[Annotation &quot; + glyph + &quot;](focusAnnotation(&quot; + i + &quot;)) - &quot; + dummyText);
                        text.push(&quot;&quot;);
                        self.text = text;
                    }
                });
            }
        },

        _actions: {

            focusAnnotation: function (i) {
                var annotation = this._annotations[i];
                if (!annotation) {
                    return;
                }
                if (this._lastAnnotation) {
                    this._lastAnnotation.labelShown = false;
                }
                annotation.labelShown = true;
                var self = this;
                this._cameraFlight.flyTo(annotation, function () {
                    if (self._speaking) {
                        speak(annotation.title);
                        speak(annotation.desc);
                    }
                });
                this._lastAnnotation = annotation;
            }
        },

        _clear: function () {
            for (var i = 0, len = this._annotations.length; i &lt; len; i++) {
                this._annotations[i].destroy();
            }
            this._annotations = [];
            this.text = [];
        },

        _dump: function () {
            var w = window.open(&quot;&quot;);
            w.document.write(&quot;&lt;pre&gt;&quot; + this.js + &quot;&lt;/pre&gt;&quot;);
        },

        _getJSON: function () {
            var annotationJSON;
            var annotations = [];
            for (var i = 0, len = this._annotations.length; i &lt; len; i++) {
                annotationJSON = this._annotations[i].json;
                delete annotationJSON[&quot;id&quot;]; // Story manages IDs
                annotations.push(annotationJSON);
            }
            return {
                text: this.text.slice(),
                annotations: annotations,
                authoring: this._authoring,
                speaking: this._speaking
            };
        },

        _destroy: function () {
            this.scene.input.off(this._onMouseClicked);
        }
    });


})();

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
